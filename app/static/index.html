<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Zapchast CRM</title>
</head>
<body>
    <h1>Zapchast CRM</h1>

    <h2>Login</h2>
    <input type="text" id="login_username" placeholder="Username" />
    <input type="password" id="login_password" placeholder="Password" />
    <button onclick="login()">Login</button>

    <hr>

    <h2>Register</h2>
    <input type="text" id="register_fullname" placeholder="Full name" />
    <input type="text" id="register_username" placeholder="Username" />
    <input type="password" id="register_password" placeholder="Password" />
    <button onclick="register()">Register</button>

    <script>
    async function register() {
        const data = {
            username: document.getElementById("register_username").value,
            password: document.getElementById("register_password").value,
            full_name: document.getElementById("register_fullname").value
        };

        try {
            const res = await fetch("/auth/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                alert("✅ Registered successfully!");
            } else {
                const err = await res.text();
                alert("❌ Register failed:\n" + err);
            }
        } catch (e) {
            alert("❌ Network error:\n" + e.message);
        }
    }

    async function login() {
        const data = {
            username: document.getElementById("login_username").value,
            password: document.getElementById("login_password").value
        };

        try {
            const res = await fetch("/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                const result = await res.json();
                localStorage.setItem("token", result.access_token);
                alert("✅ Login successful!");
            } else {
                const err = await res.text();
                alert("❌ Login failed:\n" + err);
            }
        } catch (e) {
            alert("❌ Network error:\n" + e.message);
        }
    }
    </script>
</body>
</html>
